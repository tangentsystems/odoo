<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_res_partner_filter_usa" model="ir.ui.view">
        <field name="name">res.partner.select.usa</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_res_partner_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//search" position="inside">
                <field name="ref" filter_domain="[('ref','ilike',self)]"/>
            </xpath>
        </field>
    </record>

    <!-- Create a new search and filter of customer list -->
    <record id="view_res_partner_customer_filter_usa" model="ir.ui.view">
        <field name="name">res.partner.customer.select.usa</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_res_partner_filter"/>
        <field name="mode">primary</field>
        <field name="arch" type="xml">
            <filter name="filter_my_partners" position="before">
                <!-- This is a widget filter
                    We have the syntax as follows: name is the specific field, string is the name of QWeb template,
                     context is additional parameters that you want to transfer and help is always "__widget__"
                -->
                <filter name="credit" string="AmountSearchRange" help="__widget__"
                        context='{"is_negative_checking": 0, "title_display": "Search by Total Balance"}'/>
                <separator/>
            </filter>
            <filter name="customer" position="attributes">
                <attribute name="invisible">1</attribute>
            </filter>
            <filter name="supplier" position="attributes">
                <attribute name="invisible">1</attribute>
            </filter>
        </field>
    </record>

    <!-- Create a new search and filter of vendor list -->
    <record id="view_res_partner_supplier_filter_usa" model="ir.ui.view">
        <field name="name">res.partner.supplier.select.usa</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="view_res_partner_customer_filter_usa"/>
        <field name="mode">primary</field>
        <field name="arch" type="xml">
            <filter name="credit" position="replace">
                <filter name="debit" string="AmountSearchRange" help="__widget__"
                        context='{"is_negative_checking": 0, "title_display": "Search by Total Balance"}'/>
            </filter>
        </field>
    </record>

    <record id="view_partner_tree_usa" model="ir.ui.view">
        <field name="name">res.partner.tree.usa</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_tree"/>
        <field name="arch" type="xml">
            <field name="display_name" position="before">
                <field name="ref"/>
            </field>
        </field>
    </record>

    <!--Different Tree view for Customer/Vendor in Accounting module-->
    <record id="view_partner_tree_usa_accounting" model="ir.ui.view">
        <field name="name">res.partner.tree.usa.accounting</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_tree"/>
        <field name="mode">primary</field>
        <field name="arch" type="xml">
            <tree position="inside">
                <field name="currency_id" invisible="1"/>
                <field name="ar_in_charge"/>
                <field name="user_id"/>
                <field name="open_balance" sum="Open Balance"
                       widget='monetary' options="{'currency_field': 'currency_id'}"/>
                <field name="overdue_amount" sum="Overdue Balance"
                       widget='monetary' options="{'currency_field': 'currency_id'}"/>
                <field name="credit" sum="Total Balance" string="Total Balance"
                       widget='monetary' options="{'currency_field': 'currency_id'}"/>
            </tree>
        </field>
    </record>
    <record id="view_vendor_tree_usa_accounting" model="ir.ui.view">
        <field name="name">res.vendor.tree.usa.accounting</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_tree"/>
        <field name="mode">primary</field>
        <field name="arch" type="xml">
            <tree position="inside">
                <field name="currency_id" invisible="1"/>
                <field name="debit_open_balance" sum="Open Balance"
                       widget='monetary' options="{'currency_field': 'currency_id'}"/>
                <field name="debit_overdue_amount" sum="Overdue Balance"
                       widget='monetary' options="{'currency_field': 'currency_id'}"/>
                <field name="debit" sum="Total Balance" string="Total Balance"
                       widget='monetary' options="{'currency_field': 'currency_id'}"/>
            </tree>
        </field>
    </record>

    <!--Override act_window to point to our treeview in Accounting-->
    <!-- Customers list -->
    <record id="base.action_partner_customer_form" model="ir.actions.act_window">
        <field name="domain">[('customer', '=', 1), ('parent_id', '=', False)]</field>
        <field name="context">{'default_customer': 1, 'default_supplier': 0, 'default_company_type': 'company'}</field>
        <field name="search_view_id" ref="view_res_partner_customer_filter_usa"/>
    </record>
    <record id="base.action_partner_customer_form_view1" model="ir.actions.act_window.view"> <!-- Kanban view -->
        <field eval="2" name="sequence"/>
    </record>
    <record id="base.action_partner_customer_form_view2" model="ir.actions.act_window.view"> <!-- Tree view -->
        <field eval="1" name="sequence"/>
        <field name="view_id" ref="view_partner_tree_usa_accounting"/>
    </record>

    <!-- Vendors list -->
    <record id="base.action_partner_supplier_form" model="ir.actions.act_window">
        <field name="domain">[('supplier','=',1), ('parent_id', '=', False)]</field>
        <field name="context">{'default_customer': 0, 'default_supplier': 1, 'default_company_type': 'company'}</field>
        <field name="search_view_id" ref="view_res_partner_supplier_filter_usa"/>
    </record>
    <record id="base.action_partner_vendor_form_view1" model="ir.actions.act_window.view"> <!-- Kanban view -->
        <field eval="2" name="sequence"/>
    </record>
    <record id="base.action_partner_vendor_form_view2" model="ir.actions.act_window.view"> <!-- Tree view -->
        <field eval="1" name="sequence"/>
        <field name="view_id" ref="view_vendor_tree_usa_accounting"/>
    </record>

    <record id="view_partner_form_usa" model="ir.ui.view">
        <field name="name">res.partner.form.usa</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            <field name="type" position="before">
                <field name="print_check_as"/>
                <field name="check_name" attrs="{'invisible': [('print_check_as', '=', False)],
                'required': [('print_check_as', '=', True)]}"/>
                <field name="ref" readonly="1"/>
            </field>

            <field name="vat" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>

            <xpath expr="//page[@name='sales_purchases']//field[@name='ref']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="//field[@name='child_ids']/kanban/templates//field[@name='name']" position="before">
                <strong class="contact-address-type" attrs="{'invisible':[('type', '!=', 'contact')]}">
                    Contact
                </strong>
                <strong class="contact-address-type" attrs="{'invisible':[('type', '!=', 'delivery')]}">
                    Shipping Address
                </strong>
                <strong class="contact-address-type" attrs="{'invisible':[('type', '!=', 'invoice')]}">
                    Billing Address
                </strong>
                <br/>
            </xpath>

            <field name="category_id" position="before">
                <!--Tax ID for Customer-->
                <field name="customer_tax_id" placeholder="EIN (e.g: XX-XXXXXXX)" string="Tax ID"
                       help="Employer Identification Number"
                       attrs="{'invisible': ['|', ('customer', '=', False), ('supplier', '=', True)]}"/>

                <!--Tax ID for Vendor Company-->
                <field name="vendor_company_tax_id" placeholder="EIN (e.g: XX-XXXXXXX)" string="Tax ID"
                       attrs="{'invisible': ['|', ('supplier', '=', False), ('is_company', '=', False)]}"/>

                <!--Tax ID for Vendor Individual-->
                <field name="vendor_individual_tax_id" placeholder="SSN (e.g: xxx-xx-xxxx)" string="Tax ID"
                       attrs="{'invisible': ['|', ('supplier', '=', False), ('is_company', '=', True)]}"/>

                <field name="vendor_eligible_1099" attrs="{'invisible': [('supplier', '=', False)]}"/>
            </field>
        </field>
    </record>

    <record id="view_partner_property_form_usa" model="ir.ui.view">
        <field name="name">res.partner.property.form.inherit.usa</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="account.view_partner_property_form"/>
        <field name="arch" type="xml">
            <field name="property_account_payable_id" position="after">
                <field name="ar_in_charge" attrs="{'invisible': [('customer', '=', False)]}"/>
            </field>
        </field>
    </record>

    <!-- Customerize buttons -->
    <record id="partner_view_buttons_usa" model="ir.ui.view">
        <field name="name">partner.ledger.button.usa</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="account_reports.partner_view_buttons"/>
        <field name="arch" type="xml">
            <!-- Hide Partner Ledger button for contacts -->
            <button id="partner_ledger_button" position="attributes">
                <attribute name="attrs">{'invisible': [('parent_id', '!=', False)]}</attribute>
            </button>

            <!-- Rename Due button to Customer Statement -->
            <xpath expr="(//button[@name='open_action_followup']/div/span)[last()]" position="replace">
                <span class="o_stat_text">Customer
                    <br/>
                    Statement
                </span>
            </xpath>
            <xpath expr="//button[@name='open_action_followup']" position="attributes">
                <attribute name="style">height: 54px;</attribute>
                <attribute name="attrs">{'invisible': [('customer', '=', False)]}</attribute>  <!--Always show button for Customer-->
            </xpath>
        </field>
    </record>
    <!-- Customerize Invoiced button in customer form -->
    <record id="partner_view_button_invoice_usa" model="ir.ui.view">
        <field name="name">partner.invoice.button.usa</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="account.partner_view_buttons"/>
        <field name="arch" type="xml">
           <button name='action_view_partner_invoices' position="attributes">
                <attribute name="invisible">1</attribute>
           </button>
            <button name='action_view_partner_invoices' position="before">
                <button type="object" class="oe_stat_button" icon="fa-pencil-square-o" name="action_view_open_invoices"
                        attrs="{'invisible': [('customer', '=', False)]}">
                    <div class="o_form_field o_stat_info">
                        <span class="o_stat_value">
                            <field name="num_open_invoices"/>
                        </span>
                        <span class="o_stat_text">Open Invoices</span>
                    </div>
                </button>
            </button>
        </field>
    </record>
</odoo>
